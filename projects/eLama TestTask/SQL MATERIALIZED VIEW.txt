CREATE MATERIALIZED VIEW new_users_sum_transactions
            AS
                WITH
                    new_users as(
                        SELECT 
                            u.user_id,
                            u.email
                        FROM users u
                        RIGHT JOIN webinar w ON u.email = w.email
                        WHERE u.email IS NOT NULL AND u.date_registration > '2016-04-01'
                    )
                    
                    SELECT
                        nu.email,
                        SUM(t.price) as sum_price
                    FROM new_users nu
                    LEFT JOIN transactions t ON nu.user_id = t.user_id
                    GROUP BY nu.email